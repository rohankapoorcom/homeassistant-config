# YAML anchors for shared configurations
x-card-mod-style: &card-mod-style
  style: |
    ha-card {
      --map-card-internal-zoomer-background: transparent!important;
      --map-card-room-outline-line-color: rgb(255, 255, 255, 0);
      --map-card-room-label-color: rgb(255, 255, 255);
    }
    .map-wrapper {
      height: 250px !important;
    }

x-map-modes-templates: &map-modes-templates
  - template: vacuum_clean_zone
  - template: vacuum_goto

x-vacuum-common-props: &vacuum-common-props
  vacuum_platform: Hypfer/Valetudo
  map_locked: true
  two_finger_pan: true
  append_icons: false
  append_tiles: true

x-icon-play: &icon-play
  icon: mdi:play
  tooltip: Start
  tap_action:
    action: call-service
    service: vacuum.start

x-icon-pause: &icon-pause
  icon: mdi:pause
  tooltip: Pause
  tap_action:
    action: call-service
    service: vacuum.pause

x-icon-stop: &icon-stop
  icon: mdi:stop
  tooltip: Stop
  tap_action:
    action: call-service
    service: vacuum.stop

x-icon-return: &icon-return
  icon: mdi:home-map-marker
  tooltip: Return to base
  tap_action:
    action: call-service
    service: vacuum.return_to_base

x-icon-locate: &icon-locate
  icon: mdi:map-marker
  tooltip: Locate
  tap_action:
    action: call-service
    service: vacuum.locate

x-icon-fan-speed: &icon-fan-speed
  icon: valetudo:fan-medium
  tooltip: Change fan speed
  type: menu
  menu_id: fan_speed
  icon_id: fan_speed
  available_values_attribute: options
  icon_mapping:
    min: valetudo:fan-min
    low: valetudo:fan-low
    medium: valetudo:fan-medium
    high: valetudo:fan-high
    max: valetudo:fan-max
  value_translation_keys:
    min: Min
    low: Low
    medium: Medium
    high: High
    max: Max
  tap_action:
    action: call-service
    service: select.select_option
    service_data:
      option: "[[value]]"
      entity_id: "[[entity_id]]"

x-icon-cleaning-mode: &icon-cleaning-mode
  icon: m3of:app-registration
  tooltip: Cleaning Mode
  type: menu
  menu_id: cleaning_mode
  icon_id: cleaning_mode
  available_values_attribute: options
  icon_mapping:
    mop: valetudo:mode-mop
    vacuum: valetudo:mode-vacuum
    vacuum_and_mop: valetudo:mode-vacuum-and-mop
    vacuum_then_mop: valetudo:mode-vacuum-then-mop
  value_translation_keys:
    mop: Mop
    vacuum: Vacuum
    vacuum_and_mop: Vacuum + Mop
    vacuum_then_mop: Vacuum -> Mop
  tap_action:
    action: call-service
    service: select.select_option
    service_data:
      option: "[[value]]"
      entity_id: "[[entity_id]]"

x-icon-water: &icon-water
  icon: valetudo:water-low
  tooltip: Water
  type: menu
  menu_id: water
  icon_id: water
  available_values_attribute: options
  icon_mapping:
    min: valetudo:water-min
    low: valetudo:water-low
    medium: valetudo:water-medium
    high: valetudo:water-high
    max: valetudo:water-max
  value_translation_keys:
    min: Min
    low: Low
    medium: Medium
    high: High
    max: Max
  tap_action:
    action: call-service
    service: select.select_option
    service_data:
      option: "[[value]]"
      entity_id: "[[entity_id]]"

type: custom:layout-card
cards:
  - type: custom:layout-card
    layout_type: vertical
    cards:
      - type: custom:xiaomi-vacuum-map-card
        title: Upstairs
        map_source:
          camera: camera.valetudo_upstairs_vacuum_map
        calibration_source:
          camera: true
        entity: vacuum.valetudo_upstairs_vacuum
        <<: *vacuum-common-props
        map_modes:
          - template: vacuum_clean_segment
            predefined_selections:
              - id: '1'
                icon:
                  name: mdi:shower
                  x: 2462
                  'y': 3340
                label:
                  text: Master Bathroom
                  x: 2462
                  'y': 3340
                  offset_y: 35
                outline:
                  - - 2345
                    - 3250
                  - - 2580
                    - 3250
                  - - 2580
                    - 3430
                  - - 2345
                    - 3430
              - id: '2'
                icon:
                  name: mdi:toilet
                  x: 2687
                  'y': 3332
                label:
                  text: Hallway Bathroom
                  x: 2687
                  'y': 3332
                  offset_y: 35
                outline:
                  - - 2605
                    - 3235
                  - - 2770
                    - 3235
                  - - 2770
                    - 3430
                  - - 2605
                    - 3430
              - id: '3'
                icon:
                  name: mdi:floor-plan
                  x: 2767
                  'y': 3475
                label:
                  text: Hallway
                  x: 2767
                  'y': 3475
                  offset_y: 35
                outline:
                  - - 2390
                    - 3410
                  - - 3145
                    - 3410
                  - - 3145
                    - 3560
                  - - 2390
                    - 3560
              - id: '4'
                icon:
                  name: mdi:bed-king
                  x: 2202
                  'y': 3392
                label:
                  text: Master Bedroom
                  x: 2202
                  'y': 3392
                  offset_y: 35
                outline:
                  - - 2005
                    - 3210
                  - - 2400
                    - 3210
                  - - 2400
                    - 3575
                  - - 2005
                    - 3575
              - id: '6'
                icon:
                  name: mdi:sofa
                  x: 3235
                  'y': 3507
                label:
                  text: Living Room
                  x: 3235
                  'y': 3507
                  offset_y: 35
                outline:
                  - - 2965
                    - 3200
                  - - 3505
                    - 3200
                  - - 3505
                    - 3815
                  - - 2965
                    - 3815
              - id: '7'
                icon:
                  name: mdi:stove
                  x: 2820
                  'y': 3707
                label:
                  text: Kitchen
                  x: 2820
                  'y': 3707
                  offset_y: 35
                outline:
                  - - 2675
                    - 3520
                  - - 2965
                    - 3520
                  - - 2965
                    - 3895
                  - - 2675
                    - 3895
              - id: '9'
                icon:
                  name: mdi:monitor
                  x: 2197
                  'y': 3742
                label:
                  text: Office
                  x: 2197
                  'y': 3742
                  offset_y: 35
                outline:
                  - - 1985
                    - 3540
                  - - 2410
                    - 3540
                  - - 2410
                    - 3945
                  - - 1985
                    - 3945
              - id: '10'
                icon:
                  name: mdi:table-chair
                  x: 2970
                  'y': 3322
                label:
                  text: Dining Room
                  x: 2970
                  'y': 3322
                  offset_y: 35
                outline:
                  - - 2795
                    - 3200
                  - - 3145
                    - 3200
                  - - 3145
                    - 3445
                  - - 2795
                    - 3445
          <<: *map-modes-templates
        internal_variables:
          topic: valetudo/upstairs-vacuum
        icons:
          - <<: *icon-play
            conditions:
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: cleaning
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.start
              service_data:
                entity_id: vacuum.valetudo_upstairs_vacuum
          - <<: *icon-pause
            conditions:
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: idle
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.pause
              service_data:
                entity_id: vacuum.valetudo_upstairs_vacuum
          - <<: *icon-stop
            conditions:
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: idle
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.stop
              service_data:
                entity_id: vacuum.valetudo_upstairs_vacuum
          - <<: *icon-return
            conditions:
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_upstairs_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.return_to_base
              service_data:
                entity_id: vacuum.valetudo_upstairs_vacuum
          - <<: *icon-locate
            tap_action:
              action: call-service
              service: vacuum.locate
              service_data:
                entity_id: vacuum.valetudo_upstairs_vacuum
          - <<: *icon-fan-speed
            entity: select.valetudo_upstairs_vacuum_fan
          - <<: *icon-cleaning-mode
            entity: select.valetudo_upstairs_vacuum_mode
          - <<: *icon-water
            entity: select.valetudo_upstairs_vacuum_water
        tiles:
          - tile_id: cleaning_mode
            entity: select.valetudo_upstairs_vacuum_mode
            label: Mode
            icon: mdi:developer-board
            translations:
              mop: Mop
              vacuum: Vacuum
              vacuum_and_mop: Vacuum + Mop
              vacuum_then_mop: Vacuum -> Mop
        card_mod: *card-mod-style
    view_layout:
      grid_area: left
  - type: custom:layout-card
    layout_type: vertical
    cards:
      - type: custom:xiaomi-vacuum-map-card
        title: Downstairs
        map_source:
          camera: camera.valetudo_downstairs_vacuum_map
        calibration_source:
          camera: true
        entity: vacuum.valetudo_downstairs_vacuum
        <<: *vacuum-common-props
        map_modes:
          - template: vacuum_clean_segment
            predefined_selections:
              - id: '1'
                icon:
                  name: mdi:floor-plan
                  x: 3067
                  'y': 3232
                label:
                  text: Hallway
                  x: 3067
                  'y': 3232
                  offset_y: 35
                outline:
                  - - 2540
                    - 2995
                  - - 3595
                    - 2995
                  - - 3595
                    - 3470
                  - - 2540
                    - 3470
              - id: '2'
                icon:
                  name: mdi:bed-queen
                  x: 3620
                  'y': 3160
                label:
                  text: Guest Room
                  x: 3620
                  'y': 3160
                  offset_y: 35
                outline:
                  - - 3345
                    - 2995
                  - - 3895
                    - 2995
                  - - 3895
                    - 3325
                  - - 3345
                    - 3325
              - id: '4'
                icon:
                  name: mdi:bicycle
                  x: 3732
                  'y': 3492
                label:
                  text: Gym
                  x: 3732
                  'y': 3492
                  offset_y: 35
                outline:
                  - - 3565
                    - 3350
                  - - 3900
                    - 3350
                  - - 3900
                    - 3635
                  - - 3565
                    - 3635
              - id: '5'
                icon:
                  name: mdi:shower
                  x: 3332
                  'y': 3575
                label:
                  text: Guest Bathroom
                  x: 3332
                  'y': 3575
                  offset_y: 35
                outline:
                  - - 3210
                    - 3475
                  - - 3455
                    - 3475
                  - - 3455
                    - 3675
                  - - 3210
                    - 3675
          <<: *map-modes-templates
        internal_variables:
          topic: valetudo/downstairs-vacuum
        icons:
          - <<: *icon-play
            conditions:
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: cleaning
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.start
              service_data:
                entity_id: vacuum.valetudo_downstairs_vacuum
          - <<: *icon-pause
            conditions:
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: idle
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.pause
              service_data:
                entity_id: vacuum.valetudo_downstairs_vacuum
          - <<: *icon-stop
            conditions:
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: idle
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: error
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.stop
              service_data:
                entity_id: vacuum.valetudo_downstairs_vacuum
          - <<: *icon-return
            conditions:
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: docked
              - entity: vacuum.valetudo_downstairs_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.return_to_base
              service_data:
                entity_id: vacuum.valetudo_downstairs_vacuum
          - <<: *icon-locate
            tap_action:
              action: call-service
              service: vacuum.locate
              service_data:
                entity_id: vacuum.valetudo_downstairs_vacuum
          - <<: *icon-fan-speed
            entity: select.valetudo_downstairs_vacuum_fan
          - <<: *icon-cleaning-mode
            entity: select.valetudo_downstairs_vacuum_mode
          - <<: *icon-water
            entity: select.valetudo_downstairs_vacuum_water
        tiles:
          - tile_id: cleaning_mode
            entity: select.valetudo_downstairs_vacuum_mode
            label: Mode
            icon: mdi:developer-board
            translations:
              mop: Mop
              vacuum: Vacuum
              vacuum_and_mop: Vacuum + Mop
        card_mod: *card-mod-style
      - type: custom:xiaomi-vacuum-map-card
        title: Garage
        map_source:
          camera: camera.valetudo_garage_vacuum_map
        calibration_source:
          camera: true
        entity: vacuum.valetudo_garage_vacuum
        <<: *vacuum-common-props
        map_modes:
          - template: vacuum_clean_segment
            predefined_selections:
              - id: "1"
                icon:
                  name: mdi:garage
                  x: 3387
                  "y": 3040
                label:
                  text: Garage
                  x: 3387
                  "y": 3040
                  offset_y: 35
                outline:
                  - - 3170
                    - 2710
                  - - 3605
                    - 2710
                  - - 3605
                    - 3370
                  - - 3170
                    - 3370
          <<: *map-modes-templates
        internal_variables:
          topic: valetudo/garage-vacuum
        icons:
          - <<: *icon-play
            conditions:
              - entity: vacuum.valetudo_garage_vacuum
                value_not: cleaning
              - entity: vacuum.valetudo_garage_vacuum
                value_not: error
              - entity: vacuum.valetudo_garage_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.start
              service_data:
                entity_id: vacuum.valetudo_garage_vacuum
          - <<: *icon-pause
            conditions:
              - entity: vacuum.valetudo_garage_vacuum
                value_not: docked
              - entity: vacuum.valetudo_garage_vacuum
                value_not: idle
              - entity: vacuum.valetudo_garage_vacuum
                value_not: error
              - entity: vacuum.valetudo_garage_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.pause
              service_data:
                entity_id: vacuum.valetudo_garage_vacuum
          - <<: *icon-stop
            conditions:
              - entity: vacuum.valetudo_garage_vacuum
                value_not: docked
              - entity: vacuum.valetudo_garage_vacuum
                value_not: idle
              - entity: vacuum.valetudo_garage_vacuum
                value_not: error
              - entity: vacuum.valetudo_garage_vacuum
                value_not: paused
            tap_action:
              action: call-service
              service: vacuum.stop
              service_data:
                entity_id: vacuum.valetudo_garage_vacuum
          - <<: *icon-return
            conditions:
              - entity: vacuum.valetudo_garage_vacuum
                value_not: docked
              - entity: vacuum.valetudo_garage_vacuum
                value_not: returning
            tap_action:
              action: call-service
              service: vacuum.return_to_base
              service_data:
                entity_id: vacuum.valetudo_garage_vacuum
          - <<: *icon-locate
            tap_action:
              action: call-service
              service: vacuum.locate
              service_data:
                entity_id: vacuum.valetudo_garage_vacuum
          - <<: *icon-fan-speed
            entity: select.valetudo_garage_vacuum_fan
          - <<: *icon-cleaning-mode
            entity: select.valetudo_garage_vacuum_mode
          - <<: *icon-water
            entity: select.valetudo_garage_vacuum_water
        tiles:
          - tile_id: cleaning_mode
            entity: select.valetudo_garage_vacuum_mode
            label: Mode
            icon: mdi:developer-board
            translations:
              mop: Mop
              vacuum: Vacuum
              vacuum_and_mop: Vacuum + Mop
        card_mod: *card-mod-style
    view_layout:
      grid_area: right
layout_type: custom:grid-layout
layout:
  grid-template-columns: 1fr 1fr
  grid-template-rows: auto
  grid-template-areas: |
    "left right"
  mediaquery:
    '(max-width: 800px)':
      grid-template-columns: 1fr
      grid-template-areas: |
        "left"
        "right"
view_layout:
  grid_area: main
